# Лабораторная работа 4: Анализ текста и создание отчетов

## Описание

Данная лабораторная работа демонстрирует работу с текстовыми файлами, анализ частоты слов и создание отчетов в различных форматах. Реализованы две программы для анализа текста и вывода результатов.

## Структура файлов

```
lab04/
├── io_txt_csv.py    # Модуль с функциями read_text и write_csv
├── io_report.py     # Программа для создания CSV отчетов
├── text_report.py   # Основной скрипт для анализа текста
├── report.csv       # Пример созданного отчета
└── README.md        # Данный файл
```

## Задания

### Задание A - Модуль `io_txt_csv.py`
![Задание А - Вывод в терминале](/img/lab04/A_1.png)
![Задание А - CSV Файл](/img/lab04/A_2.png)

Модуль с чистыми функциями для чтения текста и записи CSV согласно техническому заданию.

#### Функциональность:
- `read_text()` - чтение текстовых файлов с поддержкой различных кодировок
- `write_csv()` - запись данных в CSV файлы с поддержкой заголовков
- `frequencies_from_text()` - подсчет частот слов в тексте
- `sorted_word_counts()` - сортировка слов по частоте
- `format_word_table()` - красивое форматирование таблицы в консоли
- Обработка краевых случаев

#### Использование:
```bash
# Анализ файла по умолчанию (data/samples/input.txt)
python src/lab04/io_txt_csv.py

# Анализ конкретного файла
python src/lab04/io_txt_csv.py path/to/your/file.txt
```

#### Пример вывода:
```
Анализ файла: data/input.txt
==================================================
word    count
-------------
привет  2
мир     1

CSV отчет сохранен: data/output_report.csv
```

### Задание B - Скрипт `text_report.py`
![Задание В - Вывод в терминале](/img/lab04/B_1.png)
![Задание В - CSV Файл](/img/lab04/B_2.png)
Скрипт для анализа текста и создания отчетов согласно техническому заданию.

#### Функциональность:
- Чтение текстовых файлов с поддержкой различных кодировок
- Нормализация и токенизация текста (использует `lib.text`)
- Подсчет частот слов и сортировка
- Создание CSV отчетов с заголовками
- Вывод статистики в консоль
- Поддержка аргументов командной строки

#### Использование:
```bash
# Анализ файла по умолчанию (data/input.txt)
python src/lab04/text_report.py

# Анализ указанного файла
python src/lab04/text_report.py --in data/input.txt --out data/report.csv

# Анализ с указанием кодировки
python src/lab04/text_report.py --in data/input.txt --encoding cp1251
```

#### Пример вывода:
```
Анализ файла: data/input.txt
Выходной файл: data/report.csv
Кодировка: utf-8
==================================================
Всего слов: 3
Уникальных слов: 2
Топ-5:
привет:2
мир:1
```

### Дополнительная программа `io_report.py`

Дополнительная программа для создания CSV отчетов (альтернативная реализация).

#### Использование:
```bash
# Анализ файла по умолчанию
python src/lab04/io_report.py

# Анализ указанного файла
python src/lab04/io_report.py data/samples/input.txt

# Анализ с указанием выходного файла
python src/lab04/io_report.py data/samples/input.txt custom_report.csv
```

## Зависимости

Программы используют следующие модули:
- `collections.Counter` - для подсчета частот
- `pathlib.Path` - для работы с путями к файлам
- `csv` - для создания CSV отчетов
- `typing` - для типизации

Также используется библиотека `lib.text` с функциями:
- `normalize()` - нормализация текста
- `tokenize()` - токенизация текста

## Тестовые данные

### Основные тестовые файлы:
- `data/input.txt` - основной тестовый файл
- `data/a.txt` - дополнительный тестовый файл
- `data/b.txt` - дополнительный тестовый файл

### Содержимое тестовых файлов:
- `data/input.txt`: "Привет, мир! Привет!!!"
- `data/a.txt`: "Привет мир"
- `data/b.txt`: "Привет, привет!"

## Тест-кейсы

### A. Один файл (база)
**Вход:** `data/input.txt` с содержимым "Привет, мир! Привет!!!"

**Ожидаемый результат:**
- `data/report.csv`:
  ```csv
  word,count
  привет,2
  мир,1
  ```
- Консольный вывод:
  ```
  Всего слов: 3
  Уникальных слов: 2
  Топ-5:
  привет:2
  мир:1
  ```

### B. Пустой файл
**Вход:** Пустой файл

**Ожидаемый результат:** `report.csv` содержит только заголовок `word,count`

### C. Кодировка cp1251
**Вход:** Файл в кодировке cp1251 с текстом "Привет"

**Команда:** `python src/lab04/text_report.py --in data/cp1251_input.txt --encoding cp1251`

**Ожидаемый результат:** Корректное чтение и отчёт `привет,1`

## Особенности реализации

### Обработка текста:
1. **Нормализация**: Приведение к нижнему регистру, замена ё на е, удаление лишних пробелов
2. **Токенизация**: Разбиение на слова с поддержкой составных слов через дефис
3. **Подсчет**: Использование Counter для эффективного подсчета частот
4. **Сортировка**: По частоте (убывание), затем по алфавиту

### Архитектура программ:
- Модульная структура с разделением функций
- Обработка ошибок с информативными сообщениями
- Поддержка аргументов командной строки
- Типизация для лучшей читаемости кода
- Документация всех функций

### Краевые случаи:

#### Функция `read_text`:
- **Пустой файл** → возвращается пустая строка
- **Очень большой файл** → читается целиком (в реальности стоит читать построчно для оптимизации памяти)

#### Функция `write_csv`:
- **Пустые rows и header=None** → создается пустой файл (0 строк)
- **header=("a","b") с пустыми rows** → файл содержит только заголовок
- **Обычные данные с заголовком** → создается полноценный CSV файл

## Примеры использования

### Создание отчета для анализа:
```bash
# Создаем CSV отчет
python src/lab04/io_report.py data/samples/input.txt analysis_report.csv

# Просматриваем результаты в консоли
python src/lab04/io_txt_csv.py data/samples/input.txt
```

### Обработка разных файлов:
```bash
# Анализ файла с русским текстом
python src/lab04/io_report.py russian_text.txt russian_report.csv

# Анализ файла с английским текстом
python src/lab04/io_report.py english_text.txt english_report.csv
```

## Обработка ошибок

Программы корректно обрабатывают следующие ситуации:
- Отсутствие входного файла
- Ошибки чтения файла
- Ошибки записи CSV файла
- Некорректные аргументы командной строки

